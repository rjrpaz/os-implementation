<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 4. Overview of the Projects</title><meta name="generator" content="DocBook XSL Stylesheets V1.64.1"><link rel="home" href="index.html" title="Hacking GeekOS"><link rel="up" href="index.html" title="Hacking GeekOS"><link rel="previous" href="overview.html" title="Chapter 3. Overview of GeekOS"><link rel="next" href="introproject.html" title="Chapter 5. Project 0: Getting Started"><style type="text/css"><!--.style1 {	font-family: "Courier New", Courier, mono;	font-size: 12px;	font-weight: bold;}.style2 {font-family: "Courier New", Courier, mono}.style6 {	font-family: "Courier New", Courier, mono;	font-weight: bold;	font-size: small;}.style8 {font-size: small}--></style></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 4. Overview of the Projects</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="overview.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="introproject.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="projectoverview"></a>Chapter 4. Overview of the Projects</h2></div></div></div>  <div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="projectoverview.html#projectsbrief">1. Project Descriptions</a></span></dt><dt><span class="sect1"><a href="projectoverview.html#requiredsoftware">2. Required Software</a></span></dt><dt><span class="sect1"><a href="projectoverview.html#installing">3. Setting Up the GeekOS Distribution</a></span></dt><dt><span class="sect1"><a href="projectoverview.html#extracting">4. Starting a Project</a></span></dt><dt><span class="sect1"><a href="projectoverview.html#transition">5. Continuing to a New Project</a></span></dt><dt><span class="sect1"><a href="projectoverview.html#compiling">6. Compiling a Project</a></span></dt><dt><span class="sect1"><a href="projectoverview.html#running">7. Running GeekOS Using Bochs</a></span></dt><dt><span class="sect1"><a href="projectoverview.html#troubleshooting">8. Troubleshooting</a></span></dt><dt><span class="sect1"><a href="projectoverview.html#hints">9. Project Hints</a></span></dt></dl></div><p>This chapter gives a brief overview of the projects in which you will addimportant new functionality to the GeekOS kernel.  It also discussesall of the requirements for compiling and running GeekOS.</p><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="projectsbrief"></a>1. Project Descriptions</h2></div></div></div><p>There are a total of seven projects.  For the most part, each project buildson the one before it, so you will need to do them in order.The projects were originally developed as part of a seniorlevel undergraduate operating systems course, sothe complete sequence will require a significant amount of effort tocomplete.  Some projects will be moredifficult than others; in particular, the virtual memory project(<a href="vmproject.html" title="Chapter 9. Project 4: Virtual Memory">Chapter 9, <i>Project 4: Virtual Memory</i></a>) and the filesystem project (<a href="fsproject.html" title="Chapter 10. Project 5: A Filesystem">Chapter 10, <i>Project 5: A Filesystem</i></a>)require you to write a fairly large amount of code (several hundred toa thousand lines of code for each project).  The good news is that whenyou complete the last project, GeekOS will be a functional operatingsystem, capable of running multiple process with full memory protection.</p><p>Project 0 (<a href="introproject.html" title="Chapter 5. Project 0: Getting Started">Chapter 5, <i>Project 0: Getting Started</i></a>) serves as an introduction tomodifying, building, and running GeekOS.  You will add a  kernelthread to read keys from the keyboard and echo them to the screen.</p><p>For Project 1 (<a href="elfparsingproject.html" title="Chapter 6. Project 1: Loading Executable Files">Chapter 6, <i>Project 1: Loading Executable Files</i></a>), you becomefamiliar with the structure of an executable file. You are providedwith code for loading and running executable files, but you need tofirst become familiar with the ELF file format, then write code to parse the provided file and pass it to the loader.</p><p>In Project 2 (<a href="usermodeproject.html" title="Chapter 7. Project 2: Adding Processes">Chapter 7, <i>Project 2: Adding Processes</i></a>), you will addsupport for <span class="emphasis"><em>user mode processes</em></span>.  Rather than usingvirtual memory to provide separate user address spaces, this projectuses <span class="emphasis"><em>segmentation</em></span>, which is simpler to understand.</p><p>Project 3 (<a href="schedulingproject.html" title="Chapter 8. Project 3: Scheduling">Chapter 8, <i>Project 3: Scheduling</i></a>) improves the GeekOS schedulerand adds support for semaphores to coordinate multiple processes.</p><p>Project 4 (<a href="vmproject.html" title="Chapter 9. Project 4: Virtual Memory">Chapter 9, <i>Project 4: Virtual Memory</i></a>) replaces the segmentation baseduser memory protection added in Project 1 with paged virtual memory.Pages of memory can be stored on disk in order to free up RAM whenthe demand for memory exceeds the amount available.</p><p>Project 5 (<a href="fsproject.html" title="Chapter 10. Project 5: A Filesystem">Chapter 10, <i>Project 5: A Filesystem</i></a>) adds a hierarchical read/writefilesystem to GeekOS.</p><p>Project 6 (<a href="ipcproject.html" title="Chapter 11. Project 6: ACLs and Inter-process Communication">Chapter 11, <i>Project 6: ACLs and Inter-process Communication</i></a>) adds access control lists(ACLs) to the filesystem, and adds interprocess communication usinganonymous half-duplex pipes.  Upon the completion of this project, GeekOS willresemble a very simple version of Unix.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="requiredsoftware"></a>2. Required Software</h2></div></div></div><p>Compiling GeekOS requires a number of tools.  The good news is that if youare running on a Linux/x86 or FreeBSD/x86 system, or if you arerunning <a href="http://cygwin.com/" target="_top">Cygwin</a> on Windows, you probably havemost or all of the software you need to compile GeekOS already installed.If you don't, it is generally not too difficult to obtain the requiredsoftware.</p><p>The following is a complete list of software needed to compile GeekOS.</p><div class="itemizedlist"><ul type="disc"><li><p><a href="http://gcc.gnu.org/" target="_top">gcc</a>, version 2.95.2 or later,  targeting any i386/ELF platform, or targeting PECOFF under Cygwin</p></li><li><p>Any ANSI-compliant C compiler for the host platform (the computer  you are planning to compile GeekOS on); unless you are cross-compiling,  this can be the same compiler you use to compile GeekOS</p></li><li><p><a href="http://www.gnu.org/software/binutils/" target="_top">GNU binutils</a>,  targeting any i386/ELF platform, or PECOFF under Cygwin; you probably already have this if you  have gcc</p></li><li><p><a href="http://www.gnu.org/software/make/" target="_top">GNU Make</a>; the GeekOS  makefile will not work with other versions of make</p></li><li><p><a href="http://www.perl.org/" target="_top">Perl</a>, version 5 or  later</p></li><li><p><a href="http://www.gnu.org/software/grep/grep.html" target="_top">egrep</a></p></li><li><p><a href="http://www.gnu.org/software/gawk/" target="_top">AWK</a></p></li><li><p><a href="http://www.gnu.org/software/diffutils/" target="_top">diff3</a></p></li><li><p><a href="http://nasm.sourceforge.net/" target="_top">NASM</a>; on Linux or  FreeBSD systems, this is probably the only required software not already installed</p></li></ul></div><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div> <h2 class="title" style="clear: both"><a name="installing"></a>3. Setting Up the GeekOS Distribution</h2></div><div><div class="sect1" lang="en"><p>Projects will be accomplished in groups (nominally 2 persons in each group). Each group will have an account defined. The login names for the accounts are <span class="style2">Group0</span>, <span class="style2">Group1</span>, <span class="style2">Group2</span>, etc. There are also Unix file access groups defined, with names <span class="style2">group0</span>, <span class="style2">group1</span>, <span class="style2">group2</span>, etc. These unix groups are the primary group for each of the Group accounts. Once the students working together in a group have been defined, the students' individual logins will be added to the membership of the appropriate unix group.</p>    <p>For example, suppose students Alan Turing, with login <span class="style2">turing_a</span>, and Fred Brooks, with login <span class="style2">brooks_f</span> are working together in group 2. The shared account would be <span class="style2">Group2</span>, and the membership of unix group <span class="style2">group2</span> would include <span class="style2">Group2</span>, <span class="style2">turing_a</span>, and <span class="style2">brooks_f</span>. </p>    <p>We will use the Group account to store the CVS repository, and will create a separate project within the CVS repository for each of the seven GeekOS projects. The Group account will also be used for storage of the full GeekOS distribution, and as a staging area as we import the set of files for each project into their respective CVS repository project tree. </p>    <p>Editing of files and building versions of your GeekOS kernel will <em><strong>not</strong></em> occur in the Group account. We will use the facilities of CVS to create a working copy of the files into an  area in each students' individual accounts. This working area is known as a <em>sandbox</em>. Within the sandbox, files will be created and/or edited, and then compiled, and tested. Once a stable set of changes have been made, these will be reflected back into the CVS repository in the group account through a <em>commit</em> operation. More on CVS as we go along. </p>    <p>We use the unix group file access controls to allow individual group members to read and write the files in the shared Group account. We must make sure, however, that once one member creates or writes a file, that other members may subsequently write the same file. To do this, we need to make sure that all files and directories created by any of the members of the group have file system rights for the group members.&nbsp; To do this, we need to take two steps.&nbsp; First, the home directory of the group should have the sgid (set group id) bit set for both owner and group.&nbsp; Second, we change the umask to open up permissions for group members.</p>    <p>First, login to your Group account and take the following steps: </p>     <p class="style2"><span class="style8"><tt class="prompt">$ </tt><strong>cd</strong><br>          <tt class="prompt">$ </tt><strong>chmod ug+rwxs .</strong><br>          <tt class="prompt">$ </tt><strong>umask 0007</strong></span></p>     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">      <table border="0" summary="Note">        <tr>          <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../cs372-f05/geekos_project/figures/note.png" width="24" height="24"></td>          <th align="left">Note</th>        </tr>        <tr>          <td colspan="2" align="left" valign="top"><p> This document assumes that you are using a Unix-like system such as Linux, FreeBSD, or MacOS/X, and that you are using the <a href="http://www.gnu.org/software/bash/" target="_top">bash</a> shell, or a similar shell such as the Bourne (/bin/sh) or Korn (/bin/ksh) shells. </p></td>        </tr>      </table>    </div>    <p>Test these instructions by logging into your individual account and try creating a file in the Group account. Be sure and first set your umask to 0007 as we did above. The created file should be owned by the student user, but should be assigned to the unix group and should be readable and writeable by both user and group. For the scenario given above, a created file foo would look as follows by an 'ls -l':</p>    <p class="style6">-rw-rw---- 1 turing_a group2 0 Aug 14 08:12 foo</p>    <p>If this is successful, then it is time to lay down the GeekOS distribution in the group account. A GeekOS distribution is a file whose name looks like <tt class="filename">geekos-<i class="replaceable"><tt>version</tt></i>.zip</tt>. For example, let's say you are using GeekOS version 0.3.0. The distribution is <a href="geekos-0.3.0.zip">geekos-0.3.0.zip</a> (and is available at the link). Log into your Group account and download the distribution into the home directory of the account.</p>    <p>For illustration, we will continue to use <span class="style2">Group2</span> as the example group. To install the distribution, execute the following commands from the Group account: </p>	         <p class="style2">		  <span class="style8"><tt class="prompt">$ </tt><strong>cd</strong><br>          <tt class="prompt">$ </tt><strong>umask 0007</strong><br>		  <tt class="prompt">$ </tt><strong>unzip geekos-0.3.0.zip </strong><br>		  <tt class="prompt">$ </tt><strong>rm geekos-0.3.0.zip </strong><br>		  <tt class="prompt">$ </tt><strong>mkdir import </strong><br>		  <tt class="prompt">$ </tt><strong>mkdir repository </strong><br>		  <tt class="prompt">$ </tt><strong>CVSROOT=/home/Group2/repository</strong><br>		  <tt class="prompt">$ </tt><strong>export CVSROOT </strong><br>		  <tt class="prompt">$ </tt><strong>cvs init </strong></span><br>		  </p>		  <p>Edit your <span class="style6">.bash_profile</span> in your individual accounts so that you can automate the setting of umask and the shell environment variables that are needed during GeekOS development.  Login to your account and add the following commands to your <span class="style6">.bash_profile</span> in the appropriate places:</p><p class="style2"><span class="style8">  <strong>umask 0007</strong><br>  <strong>CVSROOT=/home/Group2/repository</strong><br>  <strong>export CVSROOT</strong><br>  <strong>GEEKOS_HOME=/home/Group2/geekos-0.3.0</strong><br>  <strong>export GEEKOS_HOME</strong><br>  <strong>PATH=$GEEKOS_HOME/scripts:$PATH</strong><br>  <strong>export PATH</strong><br></span></p></div></div></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div>  <div><h2 class="title" style="clear: both"><a name="extracting"></a>4. Starting a Project</h2></div></div></div><p>Once you have installed the GeekOS distribution and all of the softwarerequired to compile it, you are ready to extract Project 0. If you are using CVS, then the steps include first the extraction of Project0 (in the group directory) and then the import of the Project0 files into the CVS repository.&nbsp; Once the files have been imported, users can log in to their individual accounts and work on the project.</p><p>&nbsp;Let's say you have chosen the directory <i class="replaceable"><tt>/home/Group1/import</tt></i>to contain the directory for this project.Then you would run the following command:</p><pre class="screen style1"><tt class="prompt">$ </tt>cd /home/Group1/import<tt class="prompt">$ </tt>startProject project0 $GEEKOS_HOME/src</pre><p>This will create a directory <i class="replaceable"><tt>/home/Group1/import/project0</tt></i>containing the GeekOS source code, ready to be imported<br>into CVS as the initial version..</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25">    <img alt="[Important]" src="../../cs372-f05/geekos_project/figures/important.png" width="24" height="24"></td><th align="left">Important</th></tr><tr>      <td align="left" valign="top"><p>  It is an extremely good idea to use <a href="http://www.cvshome.org/" target="_top">CVS</a> or a similar  version control system to store your project files.  Each time you reach  a stable point in your project, commit the source files.  That way,  you will always be able to revert to a stable version if something  goes wrong with your code.  </p></td></tr></table></div><p><tt class="prompt"><font size="2" face="Courier New">$ </font> </tt><font face="Courier New" size="2"><span><b class="command">cd /home/Group1/import/project0</b></span><br></font><tt class="prompt"><font face="Courier New" size="2">$ </font><b><font size="2" face="Courier New">cvs import -m 'Import following startProject of project0' project0 vendor start</font></b></tt></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transition"></a>5. Continuing to a New Project</h2></div></div></div><p>Each project contains a slightly different version of the base GeekOSsystem.  For example, the buffer cache system is introduced in thefourth project because it is required by the filesystem.Also, code is sometimes removed because it is no longer needed.</p><p>To make it easy for you to move your code from one project to the next,the <tt class="filename">startProject</tt> script can automatically mergeyour code from the previous project into the code for the new project.For example, let's say you have completed Project 0 and are readyto move onto Project 1.  You would run the following commands:</p><pre class="screen"><tt class="prompt">$ </tt><span><b class="command">cd /home/group1/cs372/import</b></span><tt class="prompt">$ </tt><span><b class="command">startProject project1 $GEEKOS_HOME/src &lt;location of latest project0&gt;</b>$<b class="command"> cd project1</b>$<b class="command"> cvs import -m </b></span><tt class="prompt"><b><font size="2" face="Courier New">'Import following startProject of project1' project1 vendor start</font></b></tt></pre><p></p><p>Although the process of incorporating your old code into the new project islargely automatic, you will sometimes see messages like the following:</p><pre class="screen">Warning: Conflicts detected in merge of file src/geekos/main.c</pre><p>When you look at the file in the new project directory that was reportedto contain a merge conflict, you will see something like the following:</p><pre class="screen">&lt;&lt;&lt;&lt;&lt;&lt;&lt; Your version of src/geekos/main.c=======static void Mount_Filesystems(void);static void Spawn_Init_Process(void);&gt;&gt;&gt;&gt;&gt;&gt;&gt; Master version of src/geekos/main.c from project1</pre><p>In this case, two function prototypes were added to the sourcefile <tt class="filename">src/geekos/main.c</tt>.</p><p>Note that the merge operation inserted these markers into the source code, and this version of the source code has now been imported into CVS as the first version of this project maintained in the CVS repository.&nbsp; To remedy any conflicts, you will login to your individual account and checkout this newly created project into your working area, and then start resolving any conflicts.&nbsp;</p><p>In general, you should resolve conflicts by simply deleting the conflictmarkers (the lines reading &quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;, &quot;=======&quot;,and &quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;).  This will have the effect of includingthe code from both your previous project and the new code from the master sourcefor the new project.  Sometimes you will need to comment out code fromyour previous project that will not be needed in the new project.</p><p>When you have removed all of the conflict markers, you can start workingon getting the project to compile.  Once the code compiles, youcan start working on adding the new features that the project requires. </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both">  <a name="cvscheckout"></a>6.&nbsp;CVS Checkout and Working in your Individual   Account</h2><p class="title" style="clear: both">Development work should be   constrained to your individual account.&nbsp; The basic process works as   follows:</p>  <ol>    <li><p class="title" style="clear: both">You use CVS to <i>checkout</i> a     version of the project you want to work on.&nbsp; With no additional     arguments, this retrieves the latest version that has been <i>committed</i>     to the CVS repository.&nbsp; The checkout operation copies the CVS     maintained files into a local directory named the same as the project.&nbsp;     This is your <i>sandbox</i> or <i>workspace</i>.&nbsp; </li>  <li><p class="title" style="clear: both">Within this checkout target directory   structure, you develop in the normal manner, modifying source files and using   make to build new versions of the software.</li>  <li><p class="title" style="clear: both">When your development reaches a   stable point, or when you wish to share your current version of the source   files with other members of your group, you <i>commit</i> those changes back   to the CVS repository.</li>  <li><p class="title" style="clear: both">If, during the course of development,   you have added new directories or new source files that you wish to also be   maintained by CVS, these elements need to be <i>added</i> to the CVS   repository.</li>  <li><p class="title" style="clear: both">If your group partner has committed   changes to the CVS repository and you want these changes to be reflected in   your own sandbox, you perform an <i>update</i> operation to synchronize your   sandbox with the CVS repository.</li></ol><h2 class="title" style="clear: both"><a name="compiling"></a>7. Compiling a Project</h2></div></div></div><p>Once you have used the <tt class="filename">startProject</tt> script tocreate a an initial version of your project, and you have imported the initial version into CVS, and you have installed all of thesoftware required to compile GeekOS, it should be a simple matterto compile the project.  Let's say you are going to compileProject 0.  Assuming you have set your CVSROOT environment variable appropriately, here are the commands you would use:</p><pre class="screen"><tt class="prompt">$</tt> <b>mkdir -p /home/fred/cs372/sandbox</b>$<b> cd /home/fred/cs372/sandbox</b>$<b> cvs checkout project0</b>$<b> cd project0/build</b><tt class="prompt">$</tt> <span><b class="command">make depend</b></span><tt class="prompt">$</tt> <span><b class="command">make</b></span></pre><p></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="running"></a>7. Running GeekOS Using Bochs</h2></div></div></div><p>Although GeekOS targets a real hardware platform, it is intended to berun in the <a href="http://bochs.sourceforge.net/" target="_top">Bochs</a> PC emulator.Bochs runs as an ordinary user process in your host operating system,and is available for most common operating systems.We recommend that you use Bochs version 2.0 or later; as of the timeof this writing, the latest version of Bochs is 2.1.1, whichworks well with GeekOS.</p><p>Once you have installed Bochs, you will need to edit the file<tt class="filename">build/.bochsrc</tt> in the working directoryfor your project.  In this file, you will see two entries thatlook like the following:</p><pre class="programlisting"># You will need to edit these lines to reflect your system.vgaromimage: /software/bochs-2.0.2/share/bochs/VGABIOS-lgpl-latestromimage: file=/software/bochs-2.0.2/share/bochs/BIOS-bochs-latest, address=0xf0000</pre><p>You should change the lines beginning <tt class="literal">vgaromimage</tt>and <tt class="literal">romimage</tt> so that they reflect the directoryin which you installed Bochs.  For example, if you installed Bochsin the directory <tt class="filename">/usr/local/bochs-2.1</tt>,you should replace the occurrences of <tt class="filename">/software</tt>with <tt class="filename">/usr/local/bochs-2.1</tt>.</p><p>After editing the <tt class="filename">.bochsrc</tt> file, you are ready tostart bochs.  Add the directory containing the <tt class="filename">bochs</tt>executable to your <tt class="literal">PATH</tt> environment, and theninvoke the <tt class="filename">bochs</tt> command from within the<tt class="filename">build</tt> directory of the project.  You be promptedwith a set of options.  Choose <tt class="literal">Begin simulation</tt>,or simply hit the <span><b class="keycap">Enter</b></span> or <span><b class="keycap">Return</b></span> keyto choose the default.</p><p>If GeekOS has been compiled successfully, and Bochs is configuredproperly, a window should appear emulating the VGA text screen.You are now running GeekOS!</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="troubleshooting"></a>8. Troubleshooting</h2></div></div></div><p>If GeekOS does not run correctly, look at the file <tt class="filename">bochs.out</tt>produced in the <tt class="filename">build</tt> directory of the project.If errors prevented Bochs from running, or if GeekOS crashed, thisfile will usually contain diagnostic information which identifies theproblem.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="hints"></a>9. Project Hints</h2></div></div></div><p>Every project contains placeholders indicating where you need to addcode.  These placeholders use the <tt class="literal">TODO</tt> macro.Here is an example from Project 0:</p><pre class="programlisting">TODO("Start a kernel thread to echo pressed keys");</pre><p>These placeholders are often accompanied by a comment givingyou ideas about how to approach the new functionality thatneeds to be added.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="overview.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="introproject.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 3. Overview of GeekOS </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 5. Project 0: Getting Started</td></tr></table></div></body></html>